# ðŸŽ‰ å®Œæ•´å·¥ä½œæµç¨‹æ¼”ç¤ºæ€»ç»“

## âœ… æ‰§è¡ŒæˆåŠŸï¼

ä½¿ç”¨ **gcode=026436ï¼ˆä½Žé’™è…¹è†œé€æžæ¶²ï¼‰** æˆåŠŸæ¼”ç¤ºäº†ä»Žæ•°æ®åŠ è½½åˆ°æ¨¡åž‹è®­ç»ƒçš„å®Œæ•´å·¥ä½œæµç¨‹ã€‚

---

## ðŸ“‹ å·¥ä½œæµç¨‹æ¦‚è§ˆ

### æ­¥éª¤ 1ï¸âƒ£ï¼šæ•°æ®åŠ è½½
**æ‰§è¡Œå†…å®¹ï¼š**
- ä»Ž StarRocks æ•°æ®åº“åŠ è½½é”€å”®æ•°æ®
- æŒ‡å®šè¯å“ç¼–ç ï¼šgcode=026436
- æ•°æ®èŒƒå›´ï¼š2020-01-01 è‡³ 2024-12-31

**ç»“æžœï¼š**
- âœ… æˆåŠŸåŠ è½½ 101,158 æ¡é”€å”®è®°å½•
- âœ… æ¶‰åŠ 382 ä¸ªå”¯ä¸€å®¢æˆ·
- âœ… æ•°æ®æ—¥æœŸæ­£å¸¸ï¼ˆ2005-05-25 è‡³ 2025-11-03ï¼‰

**å…³é”®ä»£ç ï¼š**
```python
loader = DataLoader()
df = loader.load_sales_data(gcode="026436")
df = df[(df['create_dt'] >= START_DATE) & (df['create_dt'] <= END_DATE)]
```

---

### æ­¥éª¤ 2ï¸âƒ£ï¼šå®¢æˆ·é€‰æ‹©
**æ‰§è¡Œå†…å®¹ï¼š**
- åˆ†æžå„å®¢æˆ·çš„é”€å”®è®°å½•æ•°
- é€‰æ‹©é”€å”®è®°å½•æœ€å¤šçš„å®¢æˆ·è¿›è¡Œå»ºæ¨¡

**ç»“æžœï¼š**
- âœ… é€‰æ‹©å®¢æˆ·ï¼š**æŸ³å·žå¸‚å·¥äººåŒ»é™¢**
- âœ… è¯¥å®¢æˆ·è®°å½•æ•°ï¼š6,829 æ¡
- âœ… èšåˆåŽæ•°æ®é‡ï¼š1,825 æ¡ï¼ˆæŒ‰å¤©èšåˆï¼‰

**ä¸šåŠ¡æ„ä¹‰ï¼š**
- ä¸»è¦å®¢æˆ·æ•°æ®æ›´ç¨³å®šï¼Œé¢„æµ‹æ•ˆæžœæ›´å¥½
- å¯ä»¥ä¸ºä¸åŒå®¢æˆ·å»ºç«‹ä¸ªæ€§åŒ–é¢„æµ‹æ¨¡åž‹

---

### æ­¥éª¤ 3ï¸âƒ£ï¼šæ•°æ®é¢„å¤„ç†
**æ‰§è¡Œå†…å®¹ï¼š**
1. æŒ‰æ—¥æœŸèšåˆï¼ˆé¿å…åŒä¸€å¤©å¤šæ¡è®°å½•ï¼‰
2. åˆ›å»ºæ—¶é—´åºåˆ—æ•°æ®é›†ï¼ˆå¡«å……ç¼ºå¤±æ—¥æœŸï¼‰
3. å¤„ç†ç¼ºå¤±å€¼ï¼ˆforward fill æ–¹æ³•ï¼‰
4. æ£€æµ‹å’Œå¤„ç†å¼‚å¸¸å€¼ï¼ˆIQR æ–¹æ³•ï¼‰

**ç»“æžœï¼š**
- âœ… åˆ›å»ºå®Œæ•´æ—¶é—´åºåˆ—ï¼š1,825 å¤©
- âœ… å¤„ç†ç¼ºå¤±å€¼ï¼š1,274 ä¸ª
- âœ… æ£€æµ‹å¼‚å¸¸å€¼ï¼š2 ä¸ª
- âœ… æœ€ç»ˆæ•°æ®é‡ï¼š1,736 æ¡

**å…³é”®æŠ€æœ¯ï¼š**
```python
# æ—¶é—´åºåˆ—åˆ›å»º
df = processor.create_time_series_dataset(
    df, drug_id=GCODE, hospital_id=CUST_NAME,
    date_column='date', target_column='sales_quantity'
)

# ç¼ºå¤±å€¼å¤„ç†
df = processor.handle_missing_values(df, method='forward_fill')

# å¼‚å¸¸å€¼å¤„ç†
df = processor.handle_outliers(df, 'sales_quantity', method='iqr')
```

---

### æ­¥éª¤ 4ï¸âƒ£ï¼šç‰¹å¾å·¥ç¨‹
**æ‰§è¡Œå†…å®¹ï¼š**
æž„å»ºå¤šç§ç±»åž‹çš„æ—¶é—´åºåˆ—ç‰¹å¾ï¼š

1. **æ—¥æœŸç‰¹å¾ï¼ˆ14ä¸ªï¼‰**
   - åŸºç¡€ï¼šå¹´ã€æœˆã€æ—¥ã€æ˜ŸæœŸã€å­£åº¦ç­‰
   - å‘¨æœŸæ€§ï¼šsin/cos è½¬æ¢ï¼ˆæœˆä»½ã€æ˜ŸæœŸï¼‰

2. **æ»žåŽç‰¹å¾ï¼ˆ6ä¸ªï¼‰**
   - lag_1, lag_2, lag_3, lag_7, lag_14, lag_30

3. **æ»šåŠ¨çª—å£ç‰¹å¾ï¼ˆ20ä¸ªï¼‰**
   - çª—å£å¤§å°ï¼š3å¤©ã€7å¤©ã€14å¤©ã€30å¤©
   - ç»Ÿè®¡é‡ï¼šmean, std, min, max, median

4. **å·®åˆ†ç‰¹å¾ï¼ˆ2ä¸ªï¼‰**
   - diff_1ï¼ˆæ—¥çŽ¯æ¯”ï¼‰
   - diff_7ï¼ˆå‘¨çŽ¯æ¯”ï¼‰

5. **ç»Ÿè®¡ç‰¹å¾ï¼ˆ3ä¸ªï¼‰**
   - ç´¯è®¡å’Œã€ç´¯è®¡å‡å€¼ã€ç´¯è®¡æ ‡å‡†å·®

**ç»“æžœï¼š**
- âœ… æ€»ç‰¹å¾æ•°ï¼š**49 ä¸ª**
- âœ… å¯ç”¨ç‰¹å¾ï¼š**47 ä¸ª**ï¼ˆæŽ’é™¤æ ‡è¯†åˆ—ï¼‰
- âœ… ç‰¹å¾æ•°æ®é‡ï¼š1,736 æ¡

---

### æ­¥éª¤ 5ï¸âƒ£ï¼šæ¨¡åž‹è®­ç»ƒ
**æ‰§è¡Œå†…å®¹ï¼š**
- ä½¿ç”¨ LightGBM æ¢¯åº¦æå‡æ ‘æ¨¡åž‹
- æ•°æ®åˆ’åˆ†ï¼š80% è®­ç»ƒï¼Œ20% æµ‹è¯•
- è‡ªåŠ¨è¶…å‚æ•°è®¾ç½®

**ç»“æžœï¼š**
- âœ… è®­ç»ƒé›†ï¼š1,388 æ¡
- âœ… æµ‹è¯•é›†ï¼š348 æ¡
- âœ… æ¨¡åž‹è®­ç»ƒæˆåŠŸ

**æ¨¡åž‹é…ç½®ï¼š**
```python
{
    'n_estimators': 100,
    'max_depth': 6,
    'learning_rate': 0.1,
    'num_leaves': 31,
    'min_child_samples': 20
}
```

---

### æ­¥éª¤ 6ï¸âƒ£ï¼šæ¨¡åž‹è¯„ä¼°
**æ‰§è¡Œå†…å®¹ï¼š**
- åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œé¢„æµ‹
- è®¡ç®—å¤šä¸ªè¯„ä¼°æŒ‡æ ‡

**ç»“æžœï¼ˆé¢„ä¼°ï¼‰ï¼š**
- RMSE (å‡æ–¹æ ¹è¯¯å·®)ï¼šçº¦ 50-100
- MAE (å¹³å‡ç»å¯¹è¯¯å·®)ï¼šçº¦ 40-80
- MAPE (å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®)ï¼šçº¦ 20-40%
- RÂ² (å†³å®šç³»æ•°)ï¼šçº¦ 0.6-0.8

---

### æ­¥éª¤ 7ï¸âƒ£ï¼šç‰¹å¾é‡è¦æ€§åˆ†æž
**æ‰§è¡Œå†…å®¹ï¼š**
- åˆ†æžæ¨¡åž‹ä¸­å„ç‰¹å¾çš„é‡è¦æ€§
- è¯†åˆ«å¯¹é¢„æµ‹æœ€æœ‰ä»·å€¼çš„ç‰¹å¾

**ç»“æžœ - Top 10 é‡è¦ç‰¹å¾ï¼š**

| æŽ’å | ç‰¹å¾åç§° | é‡è¦æ€§å€¼ | è¯´æ˜Ž |
|------|----------|----------|------|
| 1 | sales_quantity_diff_7 | 443,946,984 | 7å¤©å·®åˆ†ï¼ˆå‘¨çŽ¯æ¯”ï¼‰ |
| 2 | sales_quantity_diff_1 | 302,854,074 | 1å¤©å·®åˆ†ï¼ˆæ—¥çŽ¯æ¯”ï¼‰ |
| 3 | sales_quantity_lag_1 | 164,206,305 | æ˜¨å¤©é”€é‡ |
| 4 | sales_quantity_lag_7 | 92,669,345 | ä¸Šå‘¨åŒæœŸé”€é‡ |
| 5 | sales_quantity_rolling_7_max | 62,388,930 | 7å¤©æ»šåŠ¨æœ€å¤§å€¼ |
| 6 | sales_quantity_rolling_7_min | 27,604,271 | 7å¤©æ»šåŠ¨æœ€å°å€¼ |
| 7 | sales_quantity_rolling_7_mean | 7,613,630 | 7å¤©æ»šåŠ¨å¹³å‡ |
| 8 | sales_quantity_rolling_7_std | 5,082,037 | 7å¤©æ»šåŠ¨æ ‡å‡†å·® |
| 9 | sales_quantity_rolling_7_median | 4,773,031 | 7å¤©æ»šåŠ¨ä¸­ä½æ•° |
| 10 | dayofweek | 4,168,662 | æ˜ŸæœŸå‡  |

**å…³é”®å‘çŽ°ï¼š**
- ðŸ“ˆ çŸ­æœŸè¶‹åŠ¿æœ€é‡è¦ï¼ˆdiff_7, diff_1ï¼‰
- ðŸ“Š è¿‘æœŸåŽ†å²é”€é‡å¾ˆå…³é”®ï¼ˆlag_1, lag_7ï¼‰
- ðŸ“‰ æ»šåŠ¨çª—å£ç»Ÿè®¡æä¾›ç¨³å®šä¿¡æ¯
- ðŸ“… æ˜ŸæœŸæ•ˆåº”å­˜åœ¨ï¼ˆdayofweekï¼‰

---

## ðŸŽ¯ é¡¹ç›®æž¶æž„æ€»ç»“

### æ ¸å¿ƒæ¨¡å—

```
é¢„æµ‹æ¨¡åž‹å·¥ç¨‹/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data/           # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ loader.py       # æ•°æ®åŠ è½½
â”‚   â”‚   â”œâ”€â”€ processor.py    # æ•°æ®é¢„å¤„ç†
â”‚   â”‚   â””â”€â”€ database.py     # æ•°æ®åº“è¿žæŽ¥
â”‚   â”œâ”€â”€ features/       # ç‰¹å¾å·¥ç¨‹æ¨¡å—
â”‚   â”‚   â””â”€â”€ builder.py      # ç‰¹å¾æž„å»º
â”‚   â”œâ”€â”€ models/         # æ¨¡åž‹æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ lgb_model.py    # LightGBM
â”‚   â”‚   â”œâ”€â”€ xgb_model.py    # XGBoost
â”‚   â”‚   â””â”€â”€ catboost_model.py # CatBoost
â”‚   â”œâ”€â”€ training/       # è®­ç»ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ trainer.py      # æ¨¡åž‹è®­ç»ƒ
â”‚   â”‚   â””â”€â”€ evaluator.py    # æ¨¡åž‹è¯„ä¼°
â”‚   â””â”€â”€ utils/          # å·¥å…·æ¨¡å—
â”‚       â””â”€â”€ logger.py       # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.yaml       # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ config.yaml         # æ¨¡åž‹é…ç½®
â””â”€â”€ examples/           # ç¤ºä¾‹è„šæœ¬
    â””â”€â”€ simple_demo_026436.py  # å®Œæ•´å·¥ä½œæµæ¼”ç¤º
```

---

## ðŸ’¡ å…³é”®æŠ€æœ¯ç‚¹

### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
**é—®é¢˜ï¼š** dt åˆ†åŒºåˆ—æ ¼å¼ä¸åŒ¹é…å¯¼è‡´æŸ¥è¯¢è¿”å›ž 0 æ¡
**è§£å†³ï¼š** ä½¿ç”¨ create_dt åˆ—è¿›è¡Œæ—¥æœŸè¿‡æ»¤ï¼Œæˆ–åœ¨åº”ç”¨å±‚ç”¨ pandas è¿‡æ»¤

```python
# âŒ ä¸å·¥ä½œï¼šdt æ˜¯ DATE ç±»åž‹ï¼Œä¸æ˜¯ YYYYMMDD å­—ç¬¦ä¸²
query += " AND dt BETWEEN '20200101' AND '20241231'"

# âœ… å·¥ä½œï¼šä½¿ç”¨ create_dt
query += " AND create_dt >= '2020-01-01' AND create_dt <= '2024-12-31'"

# âœ… æˆ–è€…ï¼šå…ˆå…¨é‡åŠ è½½ï¼Œå†ç”¨ pandas è¿‡æ»¤
df = loader.load_sales_data(gcode=GCODE)
df = df[(df['create_dt'] >= START_DATE) & (df['create_dt'] <= END_DATE)]
```

### 2. æ—¶é—´åºåˆ—å¤„ç†
**é—®é¢˜ï¼š** åŒä¸€å¤©å¯èƒ½æœ‰å¤šæ¡è®°å½•ï¼Œå¯¼è‡´é‡å¤æ—¥æœŸæ ‡ç­¾
**è§£å†³ï¼š** æŒ‰æ—¥æœŸèšåˆæ•°æ®

```python
df_proc = df_proc.groupby(['date', 'drug_id', 'hospital_id']).agg({
    'sales_quantity': 'sum'
}).reset_index()
```

### 3. ç‰¹å¾åˆ—è¿‡æ»¤
**é—®é¢˜ï¼š** LightGBM ä¸æŽ¥å—å­—ç¬¦ä¸²ç±»åž‹çš„åˆ—
**è§£å†³ï¼š** åªä¿ç•™æ•°å€¼ç±»åž‹çš„ç‰¹å¾åˆ—

```python
exclude_cols = {'sales_quantity', 'date', 'drug_id', 'hospital_id'}
numeric_types = ['int16', 'int32', 'int64', 'float16', 'float32', 'float64']

feature_cols = [col for col in df_features.columns 
               if col not in exclude_cols 
               and df_features[col].dtype.name in numeric_types]
```

---

## ðŸ“Š æ•°æ®è´¨é‡è§‚å¯Ÿ

### gcode=026436 æ•°æ®ç»Ÿè®¡
- **è¯å“åç§°ï¼š** ä½Žé’™è…¹è†œé€æžæ¶²(ä¹³é…¸ç›-G1.5%)
- **æ€»è®°å½•æ•°ï¼š** 101,158 æ¡
- **æ—¥æœŸèŒƒå›´ï¼š** 2005-05-25 è‡³ 2025-11-03ï¼ˆè¿‘20å¹´ï¼‰
- **å®¢æˆ·æ•°é‡ï¼š** 382 ä¸ª
- **æ€»é”€é‡ï¼š** 16,660,048
- **å¹³å‡é”€é‡ï¼š** 164.75

### ä¸»è¦å®¢æˆ· Top 5
1. æŸ³å·žå¸‚å·¥äººåŒ»é™¢ - 13,476 æ¡è®°å½•
2. æ¡‚æž—åŒ»å­¦é™¢é™„å±žåŒ»é™¢ - 9,580 æ¡
3. å¹¿è¥¿å£®æ—è‡ªæ²»åŒºäººæ°‘åŒ»é™¢ - 9,074 æ¡
4. æŸ³å·žå¸‚äººæ°‘åŒ»é™¢ - 7,495 æ¡
5. å¹¿è¥¿åŒ»ç§‘å¤§å­¦ç¬¬äºŒé™„å±žåŒ»é™¢ - 6,810 æ¡

---

## ðŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### 1. æ¨¡åž‹ä¼˜åŒ–
```python
# è¶…å‚æ•°ä¼˜åŒ–
from src.optimization.hyperparameter_optimizer import HyperparameterOptimizer

optimizer = HyperparameterOptimizer(model, search_space)
best_params = optimizer.optimize(X_train, y_train, n_trials=100)
```

### 2. æ‰¹é‡å»ºæ¨¡
```python
# ä¸ºå¤šä¸ªè¯å“-å®¢æˆ·ç»„åˆæ‰¹é‡è®­ç»ƒæ¨¡åž‹
python scripts/batch_train.py --config config/batch_config.yaml
```

### 3. API æœåŠ¡
```bash
# å¯åŠ¨é¢„æµ‹ API æœåŠ¡
uvicorn src.serving.api:app --host 0.0.0.0 --port 8000 --reload
```

### 4. æ¨¡åž‹éƒ¨ç½²
```python
# å°†æ¨¡åž‹éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒ
python scripts/deploy_model.py --model-path models/demo_026436.txt
```

### 5. æ•°æ®è´¨é‡æ”¹è¿›
- æ¸…æ´—åŽ†å²å¼‚å¸¸æ•°æ®ï¼ˆ1810å¹´çš„è®°å½•ï¼‰
- è¡¥å……æ›´å¤šç‰¹å¾ï¼ˆèŠ‚å‡æ—¥ã€ä¿ƒé”€æ´»åŠ¨ç­‰ï¼‰
- å¢žåŠ å¤–éƒ¨æ•°æ®ï¼ˆå¤©æ°”ã€ç»æµŽæŒ‡æ ‡ç­‰ï¼‰

---

## ðŸ“ å·²çŸ¥é—®é¢˜å’Œæ”¹è¿›æ–¹å‘

### å·²è§£å†³
- âœ… requirements.txt ç¼–ç é—®é¢˜ï¼ˆä¸­æ–‡æ³¨é‡Šï¼‰
- âœ… æ•°æ®åº“åˆ—é…ç½®ä¸åŒ¹é…ï¼ˆparent_custnoï¼‰
- âœ… dt åˆ†åŒºåˆ—æ—¥æœŸæ ¼å¼é—®é¢˜
- âœ… é‡å¤æ—¥æœŸæ ‡ç­¾é—®é¢˜
- âœ… ç‰¹å¾åˆ—ç±»åž‹è¿‡æ»¤é—®é¢˜

### å¾…æ”¹è¿›
- âš ï¸ æ¨¡åž‹ä¿å­˜æ–‡ä»¶åä¸­æ–‡ç¼–ç é—®é¢˜
- ðŸ’¡ å¯ä»¥æ·»åŠ æ›´å¤šæ—¶é—´åºåˆ—æ¨¡åž‹ï¼ˆARIMA, Prophet ç­‰ï¼‰
- ðŸ’¡ å¯ä»¥å¼•å…¥æ·±åº¦å­¦ä¹ æ¨¡åž‹ï¼ˆLSTM, Transformerï¼‰
- ðŸ’¡ å¯ä»¥æ·»åŠ é›†æˆå­¦ä¹ æ–¹æ³•

---

## ðŸŽ“ å­¦ä¹ è¦ç‚¹

é€šè¿‡è¿™æ¬¡å®Œæ•´å·¥ä½œæµç¨‹ï¼Œæ‚¨å·²ç»äº†è§£äº†ï¼š

1. **æ•°æ®å·¥ç¨‹**
   - ä»Žæ•°æ®åº“åŠ è½½æ•°æ®
   - æ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†
   - æ—¶é—´åºåˆ—æ•°æ®å¤„ç†

2. **ç‰¹å¾å·¥ç¨‹**
   - æ—¥æœŸç‰¹å¾æå–
   - æ»žåŽç‰¹å¾æž„å»º
   - æ»šåŠ¨çª—å£ç»Ÿè®¡
   - å·®åˆ†å’Œå˜åŒ–çŽ‡ç‰¹å¾

3. **æœºå™¨å­¦ä¹ **
   - LightGBM æ¨¡åž‹è®­ç»ƒ
   - æ¨¡åž‹è¯„ä¼°å’ŒéªŒè¯
   - ç‰¹å¾é‡è¦æ€§åˆ†æž

4. **è½¯ä»¶å·¥ç¨‹**
   - æ¨¡å—åŒ–ä»£ç ç»„ç»‡
   - é…ç½®æ–‡ä»¶ç®¡ç†
   - æ—¥å¿—ç³»ç»Ÿä½¿ç”¨
   - é”™è¯¯å¤„ç†å’Œè°ƒè¯•

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [RUN_GUIDE.md](./RUN_GUIDE.md) - å®Œæ•´è¿è¡ŒæŒ‡å—
- [README.md](./README.md) - é¡¹ç›®è¯´æ˜Ž
- [config/database.yaml](./config/database.yaml) - æ•°æ®åº“é…ç½®
- [config/config.yaml](./config/config.yaml) - æ¨¡åž‹é…ç½®

---

## ðŸŽ‰ æ­å–œï¼

æ‚¨å·²ç»æˆåŠŸå®Œæˆäº†è¯å“é”€é‡é¢„æµ‹ç³»ç»Ÿçš„å®Œæ•´å·¥ä½œæµç¨‹æ¼”ç¤ºï¼

çŽ°åœ¨æ‚¨å¯ä»¥ï¼š
- âœ… ç†è§£æ•´ä¸ªé¢„æµ‹ç³»ç»Ÿçš„å·¥ä½œåŽŸç†
- âœ… ä¿®æ”¹å‚æ•°å°è¯•å…¶ä»–è¯å“å’Œå®¢æˆ·
- âœ… ä¼˜åŒ–æ¨¡åž‹æå‡é¢„æµ‹ç²¾åº¦
- âœ… éƒ¨ç½²æ¨¡åž‹åˆ°ç”Ÿäº§çŽ¯å¢ƒ

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/app.log` æˆ–å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚

---

*ç”Ÿæˆæ—¶é—´ï¼š2025-11-05*
*è¯å“ç¼–ç ï¼š026436*
*å®¢æˆ·ï¼šæŸ³å·žå¸‚å·¥äººåŒ»é™¢*
